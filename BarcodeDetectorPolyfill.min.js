var rA=Object.create;var S=Object.defineProperty;var sA=Object.getOwnPropertyDescriptor;var eA=Object.getOwnPropertyNames;var qA=Object.getPrototypeOf,lA=Object.prototype.hasOwnProperty;var uA=A=>S(A,"__esModule",{value:!0});var c=(A,j)=>()=>(j||A((j={exports:{}}).exports,j),j.exports);var kA=(A,j,t)=>{if(j&&typeof j=="object"||typeof j=="function")for(let r of eA(j))!lA.call(A,r)&&r!=="default"&&S(A,r,{get:()=>j[r],enumerable:!(t=sA(j,r))||t.enumerable});return A},nA=A=>kA(uA(S(A!=null?rA(qA(A)):{},"default",A&&A.__esModule&&"default"in A?{get:()=>A.default,enumerable:!0}:{value:A,enumerable:!0})),A);var X=c(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.CppObject=void 0;var V=class{constructor(j,t){this.ptr=j,this.inst=t}checkAlive(){if(!this.ptr)throw Error("Call after destroyed")}getPointer(){return this.checkAlive(),this.ptr}};g.CppObject=V});var E=c(o=>{"use strict";Object.defineProperty(o,"__esModule",{value:!0});o.ZBarConfigType=o.ZBarSymbolType=void 0;var iA;(function(A){A[A.ZBAR_NONE=0]="ZBAR_NONE",A[A.ZBAR_PARTIAL=1]="ZBAR_PARTIAL",A[A.ZBAR_EAN8=8]="ZBAR_EAN8",A[A.ZBAR_UPCE=9]="ZBAR_UPCE",A[A.ZBAR_ISBN10=10]="ZBAR_ISBN10",A[A.ZBAR_UPCA=12]="ZBAR_UPCA",A[A.ZBAR_EAN13=13]="ZBAR_EAN13",A[A.ZBAR_ISBN13=14]="ZBAR_ISBN13",A[A.ZBAR_I25=25]="ZBAR_I25",A[A.ZBAR_CODE39=39]="ZBAR_CODE39",A[A.ZBAR_PDF417=57]="ZBAR_PDF417",A[A.ZBAR_QRCODE=64]="ZBAR_QRCODE",A[A.ZBAR_CODE128=128]="ZBAR_CODE128",A[A.ZBAR_SYMBOL=255]="ZBAR_SYMBOL",A[A.ZBAR_ADDON2=512]="ZBAR_ADDON2",A[A.ZBAR_ADDON5=1280]="ZBAR_ADDON5",A[A.ZBAR_ADDON=1792]="ZBAR_ADDON"})(iA=o.ZBarSymbolType||(o.ZBarSymbolType={}));var aA;(function(A){A[A.ZBAR_CFG_ENABLE=0]="ZBAR_CFG_ENABLE",A[A.ZBAR_CFG_ADD_CHECK=1]="ZBAR_CFG_ADD_CHECK",A[A.ZBAR_CFG_EMIT_CHECK=2]="ZBAR_CFG_EMIT_CHECK",A[A.ZBAR_CFG_ASCII=3]="ZBAR_CFG_ASCII",A[A.ZBAR_CFG_NUM=4]="ZBAR_CFG_NUM",A[A.ZBAR_CFG_MIN_LEN=32]="ZBAR_CFG_MIN_LEN",A[A.ZBAR_CFG_MAX_LEN=33]="ZBAR_CFG_MAX_LEN",A[A.ZBAR_CFG_UNCERTAINTY=64]="ZBAR_CFG_UNCERTAINTY",A[A.ZBAR_CFG_POSITION=128]="ZBAR_CFG_POSITION",A[A.ZBAR_CFG_X_DENSITY=256]="ZBAR_CFG_X_DENSITY",A[A.ZBAR_CFG_Y_DENSITY=257]="ZBAR_CFG_Y_DENSITY"})(aA=o.ZBarConfigType||(o.ZBarConfigType={}))});var P=c(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.Symbol=void 0;var cA=E(),Y=class{constructor(j,t){this.ptr=j,this.ptr32=j>>2,this.buf=t,this.HEAP8=new Int8Array(t),this.HEAPU32=new Uint32Array(t),this.HEAP32=new Int32Array(t)}},R=class extends Y{get type(){return this.HEAPU32[this.ptr32]}get data(){let j=this.HEAPU32[this.ptr32+2],t=this.HEAPU32[this.ptr32+3];return Int8Array.from(this.HEAP8.subarray(t,t+j))}get points(){let j=this.HEAPU32[this.ptr32+5],r=this.HEAPU32[this.ptr32+6]>>2,q=[];for(let s=0;s<j;++s){let N=this.HEAP32[r+s*2],n=this.HEAP32[r+s*2+1];q.push({x:N,y:n})}return q}get next(){let j=this.HEAPU32[this.ptr32+8];return j?new R(j,this.buf):null}get time(){return this.HEAPU32[this.ptr32+10]}get cacheCount(){return this.HEAP32[this.ptr32+11]}get quality(){return this.HEAP32[this.ptr32+12]}},H=class extends Y{get head(){let j=this.HEAPU32[this.ptr32+2];return j?new R(j,this.buf):null}},O=class{constructor(j){this.type=j.type,this.typeName=cA.ZBarSymbolType[this.type],this.data=j.data,this.points=j.points,this.time=j.time,this.cacheCount=j.cacheCount,this.quality=j.quality}static createSymbolsFromPtr(j,t){if(j==0)return[];let q=new H(j,t).head,s=[];for(;q!==null;)s.push(new O(q)),q=q.next;return s}decode(j){return new TextDecoder(j).decode(this.data)}};b.Symbol=O});var $=c((xA,vA)=>{vA.exports="./zbar.wasm-I6PRF74I.bin"});var G=c(m=>{"use strict";var oA=m&&m.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};Object.defineProperty(m,"__esModule",{value:!0});m.loadWasmInstance=void 0;var I=oA($());m.loadWasmInstance=async A=>{let j=await fetch(I.default);if(!j.ok)return console.error("Failed to load wasm binary file at "+I.default),null;let t=await j.arrayBuffer();return(await WebAssembly.instantiate(t,A)).instance}});var z=c(d=>{"use strict";Object.defineProperty(d,"__esModule",{value:!0});d.getMemoryGrowTimestamp=d.getInstance=void 0;var _A=G(),w=null,y=new Int32Array,hA=(A,j)=>{let t=Date.now();return y[j>>2]=t/1e3|0,y[j+4>>2]=t%1e3*1e3*1e3|0,0},U=0,F=A=>{U&&console.info("zbar.wasm: Memory Grow: ",w.memory.buffer.byteLength),U=Date.now(),y=new Int32Array(w.memory.buffer)},NA={env:{clock_gettime:hA,emscripten_notify_memory_growth:F}},mA=(async()=>{let A=await _A.loadWasmInstance(NA);if(!A)throw Error("WASM was not loaded");return w=A.exports,F(0),w})();d.getInstance=async()=>await mA;d.getMemoryGrowTimestamp=()=>U});var Z=c(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.Image=void 0;var dA=X(),fA=P(),J=z(),K=class extends dA.CppObject{static async createFromGrayBuffer(j,t,r,q=0){let s=await J.getInstance(),N=new Uint8Array(s.memory.buffer),n=new Uint8Array(r),e=j*t;if(e!==n.byteLength)throw Error("dataBuf does not match width and height");let i=s.malloc(e);N.set(n,i);let l=s.Image_create(j,t,808466521,i,e,q);return new this(l,s)}static async createFromRGBABuffer(j,t,r,q=0){let s=await J.getInstance(),N=new Uint8Array(s.memory.buffer),n=new Uint8Array(r),e=j*t;if(e*4!==n.byteLength)throw Error("dataBuf does not match width and height");let i=s.malloc(e);for(let k=0;k<e;++k){let _=n[k*4],h=n[k*4+1],u=n[k*4+2];N[i+k]=_*19595+h*38469+u*7472>>16}let l=s.Image_create(j,t,808466521,i,e,q);return new this(l,s)}destroy(){this.checkAlive(),this.inst.Image_destory(this.ptr),this.ptr=0}getSymbols(){this.checkAlive();let j=this.inst.Image_get_symbols(this.ptr);return fA.Symbol.createSymbolsFromPtr(j,this.inst.memory.buffer)}};T.Image=K});var W=c(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.ImageScanner=void 0;var gA=X(),RA=z(),OA=P(),B=class extends gA.CppObject{static async create(){let j=await RA.getInstance(),t=j.ImageScanner_create();return new this(t,j)}destroy(){this.checkAlive(),this.inst.ImageScanner_destory(this.ptr),this.ptr=0}setConfig(j,t,r){return this.checkAlive(),this.inst.ImageScanner_set_config(this.ptr,j,t,r)}enableCache(j=!0){this.checkAlive(),this.inst.ImageScanner_enable_cache(this.ptr,j)}recycleImage(j){this.checkAlive(),this.inst.ImageScanner_recycle_image(this.ptr,j.getPointer())}getResults(){this.checkAlive();let j=this.inst.ImageScanner_get_results(this.ptr);return OA.Symbol.createSymbolsFromPtr(j,this.inst.memory.buffer)}scan(j){return this.checkAlive(),this.inst.ImageScanner_scan(this.ptr,j.getPointer())}};p.ImageScanner=B});var C=c(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.scanImageData=a.scanRGBABuffer=a.scanGrayBuffer=a.getDefaultScanner=void 0;var L=Z(),bA=W(),M=bA.ImageScanner.create();a.getDefaultScanner=async()=>await M;var D=async(A,j)=>{j===void 0&&(j=await M);let t=j.scan(A);if(t<0)throw Error("Scan Failed");return t===0?[]:A.getSymbols()};a.scanGrayBuffer=async(A,j,t,r)=>{let q=await L.Image.createFromGrayBuffer(j,t,A),s=await D(q,r);return q.destroy(),s};a.scanRGBABuffer=async(A,j,t,r)=>{let q=await L.Image.createFromRGBABuffer(j,t,A),s=await D(q,r);return q.destroy(),s};a.scanImageData=async(A,j)=>await a.scanRGBABuffer(A.data.buffer,A.width,A.height,j)});var AA=c(v=>{"use strict";var PA=v&&v.__createBinding||(Object.create?function(A,j,t,r){r===void 0&&(r=t),Object.defineProperty(A,r,{enumerable:!0,get:function(){return j[t]}})}:function(A,j,t,r){r===void 0&&(r=t),A[r]=j[t]}),Q=v&&v.__exportStar||function(A,j){for(var t in A)t!=="default"&&!j.hasOwnProperty(t)&&PA(j,A,t)};Object.defineProperty(v,"__esModule",{value:!0});Q(Z(),v);Q(W(),v);Q(C(),v);Q(P(),v)});var jA=nA(AA()),x={ZBAR_EAN2:"ean_2",ZBAR_EAN5:"ean_5",ZBAR_EAN8:"ean_8",ZBAR_UPCE:"upc_e",ZBAR_ISBN10:"isbn_10",ZBAR_UPCA:"upc_a",ZBAR_EAN13:"ean_13",ZBAR_ISBN13:"isbn_13",ZBAR_COMPOSITE:"composite",ZBAR_I25:"itf",ZBAR_DATABAR:"databar",ZBAR_DATABAR_EXP:"databar_exp",ZBAR_CODABAR:"codabar",ZBAR_CODE39:"code_39",ZBAR_CODE93:"code_93",ZBAR_CODE128:"code_128",ZBAR_PDF417:"pdf417",ZBAR_QRCODE:"qr_code",ZBAR_SQCODE:"sq_code"},tA=480,f=class{constructor(j={}){this.canvas=document.createElement("canvas"),this.canvas.width=tA,this.canvas.height=tA,this.ctx=this.canvas.getContext("2d"),this.formats=j.formats??Object.values(x)}static getSupportedFormats(){return new Promise((j,t)=>{j(Object.values(x))})}detect(j){return new Promise(async(t,r)=>{if(!j.width||!j.height){r("No width or height");return}(this.canvas.width!=j.width||this.canvas.height!=j.height)&&(this.canvas.width=j.width,this.canvas.height=j.height,this.ctx=this.canvas.getContext("2d")),this.ctx.drawImage(j,0,0,this.canvas.width,this.canvas.height);let q=this.ctx.getImageData(0,0,j.width,j.height),s=q.data;for(let e=0;e<s.length;e+=4){let i=parseInt((s[e]+s[e+1]+s[e+2])/3);s[e]=i,s[e+1]=i,s[e+2]=i}this.ctx.putImageData(q,0,0),q=this.ctx.getImageData(0,0,j.width,j.height);let n=(await(0,jA.scanImageData)(q)).filter(e=>!(e.points.length<2||!this.formats.includes(x[e.typeName]))).map(e=>{let i=x[e.typeName],l=null,k=null,_=null,h=null;return e.points.forEach(u=>{(!l||u.x<l.x&&u.y<l.y)&&(l=u),(!k||u.x>l.x&&u.y<l.y)&&(k=u),(!_||u.x>l.x&&u.y>l.y)&&(_=u),(!h||u.x<l.x&&u.y>l.y)&&(h=u)}),{boundingBox:DOMRectReadOnly.fromRect({x:l.x,y:l.y,width:Math.max(k.x,_.x)-Math.min(l.x,h.x),height:Math.max(k.y,_.y)-Math.min(l.y,h.y)}),cornerPoints:[l,k,_,h],format:i,rawValue:e.decode()}});t(n)})}static checkBarcodeDetectorSupport(){return"BarcodeDetector"in window}static checkWebcamSupport(){return!!(navigator.mediaDevices&&!!navigator.mediaDevices.enumerateDevices)}static setupPolyfill(){f.checkBarcodeDetectorSupport()||(window.BarcodeDetector=f)}},ZA=f;export{ZA as default};
//# sourceMappingURL=BarcodeDetectorPolyfill.min.js.map
