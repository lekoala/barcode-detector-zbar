var rA=Object.create;var p=Object.defineProperty;var sA=Object.getOwnPropertyDescriptor;var eA=Object.getOwnPropertyNames;var qA=Object.getPrototypeOf,lA=Object.prototype.hasOwnProperty;var uA=A=>p(A,"__esModule",{value:!0});var a=(A,j)=>()=>(j||A((j={exports:{}}).exports,j),j.exports);var kA=(A,j,t)=>{if(j&&typeof j=="object"||typeof j=="function")for(let r of eA(j))!lA.call(A,r)&&r!=="default"&&p(A,r,{get:()=>j[r],enumerable:!(t=sA(j,r))||t.enumerable});return A},nA=A=>kA(uA(p(A!=null?rA(qA(A)):{},"default",A&&A.__esModule&&"default"in A?{get:()=>A.default,enumerable:!0}:{value:A,enumerable:!0})),A);var x=a(N=>{"use strict";Object.defineProperty(N,"__esModule",{value:!0});N.CppObject=void 0;var z=class{constructor(j,t){this.ptr=j,this.inst=t}checkAlive(){if(!this.ptr)throw Error("Call after destroyed")}getPointer(){return this.checkAlive(),this.ptr}};N.CppObject=z});var Z=a(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.ZBarConfigType=v.ZBarSymbolType=void 0;var iA;(function(A){A[A.ZBAR_NONE=0]="ZBAR_NONE",A[A.ZBAR_PARTIAL=1]="ZBAR_PARTIAL",A[A.ZBAR_EAN8=8]="ZBAR_EAN8",A[A.ZBAR_UPCE=9]="ZBAR_UPCE",A[A.ZBAR_ISBN10=10]="ZBAR_ISBN10",A[A.ZBAR_UPCA=12]="ZBAR_UPCA",A[A.ZBAR_EAN13=13]="ZBAR_EAN13",A[A.ZBAR_ISBN13=14]="ZBAR_ISBN13",A[A.ZBAR_I25=25]="ZBAR_I25",A[A.ZBAR_CODE39=39]="ZBAR_CODE39",A[A.ZBAR_PDF417=57]="ZBAR_PDF417",A[A.ZBAR_QRCODE=64]="ZBAR_QRCODE",A[A.ZBAR_CODE128=128]="ZBAR_CODE128",A[A.ZBAR_SYMBOL=255]="ZBAR_SYMBOL",A[A.ZBAR_ADDON2=512]="ZBAR_ADDON2",A[A.ZBAR_ADDON5=1280]="ZBAR_ADDON5",A[A.ZBAR_ADDON=1792]="ZBAR_ADDON"})(iA=v.ZBarSymbolType||(v.ZBarSymbolType={}));var aA;(function(A){A[A.ZBAR_CFG_ENABLE=0]="ZBAR_CFG_ENABLE",A[A.ZBAR_CFG_ADD_CHECK=1]="ZBAR_CFG_ADD_CHECK",A[A.ZBAR_CFG_EMIT_CHECK=2]="ZBAR_CFG_EMIT_CHECK",A[A.ZBAR_CFG_ASCII=3]="ZBAR_CFG_ASCII",A[A.ZBAR_CFG_NUM=4]="ZBAR_CFG_NUM",A[A.ZBAR_CFG_MIN_LEN=32]="ZBAR_CFG_MIN_LEN",A[A.ZBAR_CFG_MAX_LEN=33]="ZBAR_CFG_MAX_LEN",A[A.ZBAR_CFG_UNCERTAINTY=64]="ZBAR_CFG_UNCERTAINTY",A[A.ZBAR_CFG_POSITION=128]="ZBAR_CFG_POSITION",A[A.ZBAR_CFG_X_DENSITY=256]="ZBAR_CFG_X_DENSITY",A[A.ZBAR_CFG_Y_DENSITY=257]="ZBAR_CFG_Y_DENSITY"})(aA=v.ZBarConfigType||(v.ZBarConfigType={}))});var R=a(g=>{"use strict";Object.defineProperty(g,"__esModule",{value:!0});g.Symbol=void 0;var cA=Z(),Q=class{constructor(j,t){this.ptr=j,this.ptr32=j>>2,this.buf=t,this.HEAP8=new Int8Array(t),this.HEAPU32=new Uint32Array(t),this.HEAP32=new Int32Array(t)}},d=class extends Q{get type(){return this.HEAPU32[this.ptr32]}get data(){let j=this.HEAPU32[this.ptr32+2],t=this.HEAPU32[this.ptr32+3];return Int8Array.from(this.HEAP8.subarray(t,t+j))}get points(){let j=this.HEAPU32[this.ptr32+5],r=this.HEAPU32[this.ptr32+6]>>2,l=[];for(let s=0;s<j;++s){let o=this.HEAP32[r+s*2],u=this.HEAP32[r+s*2+1];l.push({x:o,y:u})}return l}get next(){let j=this.HEAPU32[this.ptr32+8];return j?new d(j,this.buf):null}get time(){return this.HEAPU32[this.ptr32+10]}get cacheCount(){return this.HEAP32[this.ptr32+11]}get quality(){return this.HEAP32[this.ptr32+12]}},W=class extends Q{get head(){let j=this.HEAPU32[this.ptr32+2];return j?new d(j,this.buf):null}},f=class{constructor(j){this.type=j.type,this.typeName=cA.ZBarSymbolType[this.type],this.data=j.data,this.points=j.points,this.time=j.time,this.cacheCount=j.cacheCount,this.quality=j.quality}static createSymbolsFromPtr(j,t){if(j==0)return[];let l=new W(j,t).head,s=[];for(;l!==null;)s.push(new f(l)),l=l.next;return s}decode(j){return new TextDecoder(j).decode(this.data)}};g.Symbol=f});var V=a((QA,vA)=>{vA.exports="./zbar.wasm-I6PRF74I.bin"});var H=a(_=>{"use strict";var oA=_&&_.__importDefault||function(A){return A&&A.__esModule?A:{default:A}};Object.defineProperty(_,"__esModule",{value:!0});_.loadWasmInstance=void 0;var E=oA(V());_.loadWasmInstance=async A=>{let j=await fetch(E.default);if(!j.ok)return console.error("Failed to load wasm binary file at "+E.default),null;let t=await j.arrayBuffer();return(await WebAssembly.instantiate(t,A)).instance}});var Y=a(m=>{"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.getMemoryGrowTimestamp=m.getInstance=void 0;var _A=H(),O=null,S=new Int32Array,mA=(A,j)=>{let t=Date.now();return S[j>>2]=t/1e3|0,S[j+4>>2]=t%1e3*1e3*1e3|0,0},X=0,$=A=>{X&&console.info("zbar.wasm: Memory Grow: ",O.memory.buffer.byteLength),X=Date.now(),S=new Int32Array(O.memory.buffer)},hA={env:{clock_gettime:mA,emscripten_notify_memory_growth:$}},NA=(async()=>{let A=await _A.loadWasmInstance(hA);if(!A)throw Error("WASM was not loaded");return O=A.exports,$(0),O})();m.getInstance=async()=>await NA;m.getMemoryGrowTimestamp=()=>X});var y=a(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.Image=void 0;var dA=x(),fA=R(),I=Y(),G=class extends dA.CppObject{static async createFromGrayBuffer(j,t,r,l=0){let s=await I.getInstance(),o=new Uint8Array(s.memory.buffer),u=new Uint8Array(r),q=j*t;if(q!==u.byteLength)throw Error("dataBuf does not match width and height");let k=s.malloc(q);o.set(u,k);let e=s.Image_create(j,t,808466521,k,q,l);return new this(e,s)}static async createFromRGBABuffer(j,t,r,l=0){let s=await I.getInstance(),o=new Uint8Array(s.memory.buffer),u=new Uint8Array(r),q=j*t;if(q*4!==u.byteLength)throw Error("dataBuf does not match width and height");let k=s.malloc(q);for(let n=0;n<q;++n){let AA=u[n*4],jA=u[n*4+1],tA=u[n*4+2];o[k+n]=AA*19595+jA*38469+tA*7472>>16}let e=s.Image_create(j,t,808466521,k,q,l);return new this(e,s)}destroy(){this.checkAlive(),this.inst.Image_destory(this.ptr),this.ptr=0}getSymbols(){this.checkAlive();let j=this.inst.Image_get_symbols(this.ptr);return fA.Symbol.createSymbolsFromPtr(j,this.inst.memory.buffer)}};b.Image=G});var U=a(P=>{"use strict";Object.defineProperty(P,"__esModule",{value:!0});P.ImageScanner=void 0;var gA=x(),RA=Y(),OA=R(),F=class extends gA.CppObject{static async create(){let j=await RA.getInstance(),t=j.ImageScanner_create();return new this(t,j)}destroy(){this.checkAlive(),this.inst.ImageScanner_destory(this.ptr),this.ptr=0}setConfig(j,t,r){return this.checkAlive(),this.inst.ImageScanner_set_config(this.ptr,j,t,r)}enableCache(j=!0){this.checkAlive(),this.inst.ImageScanner_enable_cache(this.ptr,j)}recycleImage(j){this.checkAlive(),this.inst.ImageScanner_recycle_image(this.ptr,j.getPointer())}getResults(){this.checkAlive();let j=this.inst.ImageScanner_get_results(this.ptr);return OA.Symbol.createSymbolsFromPtr(j,this.inst.memory.buffer)}scan(j){return this.checkAlive(),this.inst.ImageScanner_scan(this.ptr,j.getPointer())}};P.ImageScanner=F});var L=a(i=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.scanImageData=i.scanRGBABuffer=i.scanGrayBuffer=i.getDefaultScanner=void 0;var J=y(),bA=U(),K=bA.ImageScanner.create();i.getDefaultScanner=async()=>await K;var B=async(A,j)=>{j===void 0&&(j=await K);let t=j.scan(A);if(t<0)throw Error("Scan Failed");return t===0?[]:A.getSymbols()};i.scanGrayBuffer=async(A,j,t,r)=>{let l=await J.Image.createFromGrayBuffer(j,t,A),s=await B(l,r);return l.destroy(),s};i.scanRGBABuffer=async(A,j,t,r)=>{let l=await J.Image.createFromRGBABuffer(j,t,A),s=await B(l,r);return l.destroy(),s};i.scanImageData=async(A,j)=>await i.scanRGBABuffer(A.data.buffer,A.width,A.height,j)});var M=a(c=>{"use strict";var PA=c&&c.__createBinding||(Object.create?function(A,j,t,r){r===void 0&&(r=t),Object.defineProperty(A,r,{enumerable:!0,get:function(){return j[t]}})}:function(A,j,t,r){r===void 0&&(r=t),A[r]=j[t]}),w=c&&c.__exportStar||function(A,j){for(var t in A)t!=="default"&&!j.hasOwnProperty(t)&&PA(j,A,t)};Object.defineProperty(c,"__esModule",{value:!0});w(y(),c);w(U(),c);w(L(),c);w(R(),c)});var D=nA(M()),T={ZBAR_EAN2:"ean_2",ZBAR_EAN5:"ean_5",ZBAR_EAN8:"ean_8",ZBAR_UPCE:"upc_e",ZBAR_ISBN10:"isbn_10",ZBAR_UPCA:"upc_a",ZBAR_EAN13:"ean_13",ZBAR_ISBN13:"isbn_13",ZBAR_COMPOSITE:"composite",ZBAR_I25:"itf",ZBAR_DATABAR:"databar",ZBAR_DATABAR_EXP:"databar_exp",ZBAR_CODABAR:"codabar",ZBAR_CODE39:"code_39",ZBAR_CODE93:"code_93",ZBAR_CODE128:"code_128",ZBAR_PDF417:"pdf417",ZBAR_QRCODE:"qr_code",ZBAR_SQCODE:"sq_code"},C=480,h=class{constructor(j={}){this.canvas=document.createElement("canvas"),this.canvas.width=C,this.canvas.height=C,this.ctx=this.canvas.getContext("2d"),this.formats=j.formats||Object.values(T)}static getSupportedFormats(){return new Promise((j,t)=>{j(Object.values(T))})}detect(j){return new Promise(async(t,r)=>{if(!j.width||!j.height){r("No width or height");return}(this.canvas.width!=j.width||this.canvas.height!=j.height)&&(this.canvas.width=j.width,this.canvas.height=j.height,this.ctx=this.canvas.getContext("2d")),this.ctx.drawImage(j,0,0,this.canvas.width,this.canvas.height);let l=this.ctx.getImageData(0,0,j.width,j.height),s=l.data;for(let q=0;q<s.length;q+=4){let k=parseInt((s[q]+s[q+1]+s[q+2])/3);s[q]=k,s[q+1]=k,s[q+2]=k}this.ctx.putImageData(l,0,0),l=this.ctx.getImageData(0,0,j.width,j.height);let u=(await(0,D.scanImageData)(l)).filter(q=>!(q.points.length<2||!this.formats.includes(T[q.typeName]))).map(q=>{let k=T[q.typeName],e={minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0};return q.points.forEach(n=>{e.minX=Math.min(e.minX,n.x),e.maxX=Math.max(e.maxX,n.x),e.minY=Math.min(e.minY,n.y),e.maxY=Math.max(e.maxY,n.y)}),{boundingBox:DOMRectReadOnly.fromRect({x:e.minX,y:e.minY,width:e.maxX-e.minX,height:e.maxY-e.minY}),cornerPoints:[{x:e.minX,y:e.minY},{x:e.maxX,y:e.minY},{x:e.maxX,y:e.maxY},{x:e.minX,y:e.maxY}],format:k,rawValue:q.decode(),quality:q.quality}});t(u)})}static checkBarcodeDetectorSupport(){return"BarcodeDetector"in window}static checkWebcamSupport(){return!!(navigator.mediaDevices&&!!navigator.mediaDevices.enumerateDevices)}static checkSecureContext(){return!!window.isSecureContext}static setupPolyfill(){h.checkBarcodeDetectorSupport()||(window.BarcodeDetector=h)}},ZA=h;export{ZA as default};
//# sourceMappingURL=BarcodeDetectorPolyfill.min.js.map
